\input{prelude}

\usepackage{qrcode}

\SetupMinted{}
\SetupBibliography{relazione.bib}

\begin{document}

\twocolumn[{\begin{figure}[H]
        \setlength{\linewidth}{\textwidth}
        \setlength{\hsize}{\textwidth}
        \centering
        \begin{NiceTabular}{rl}
            \Block{3-1}{\includegraphics[height=20ex]{logo}} & {\Large\bfseries Carroponte smart}                                        \\
                                                             & Giuseppe Damiata, Vincenzo Mazza, Nicolò Spingola \\
                                                             & Università degli studi di Palermo, Dipartimento di Ingegneria, Hangar\_9
                                                             \\ \\ \\ % extra rows for logo spacing
        \end{NiceTabular}
\end{figure}}]

\begin{abstract}
    Nella presente relazione si descrive il progetto di un carroponte smart, ovvero un carroponte
    completamente automatizzato grazie all'utilizzo sinergico di un PLC Zelio Logic SR3B261BD,
    completo di moduli aggiuntivi SR343XTBD e SR3NET01BD, ed un Arduino MEGA. Il progetto è capace
    di caricare e scaricare container da una nave merce in totale autonomia, con un totale di
    quattro zone di carico (due poste sul porto e due sulla nave). Inoltre, è possibile monitorare
    da remoto e telecontrollare il carroponte grazie ad un sistema SCADA realizzato con il software
    Vijeo Citect ed il protocollo Modbus. \cite{arm2015real}
\end{abstract}

\section{Introduzione e scopo del progetto}

I carriponte sono macchine utilizzate per il sollevamento e lo spostamento di carichi pesanti;
trovano larga applicazione in innumerevoli campi, tra cui le navi merce, cantieri edili e magazzini.
In particolare si è scelto di modellare un carroponte portuale, dato il suo alto potenziale per
l'applicazione dell'automazione industriale: Le zone da cui caricare/scaricare sono praticamente
fisse, ovvero si carica sempre dalla nave al porto e viceversa.
\cite{ren2021design,li2015data}

L'automatizzazione di tali dispositivi rappresenta un grande vantaggio, permettendo di ridurre i
tempi di fermo macchina (incrementando dunque l'efficienza), diminuire i costi a lungo termine e
rendere molto più sicuro l'intero impianto grazie all'eliminazione dell'elemento umano.
\cite{gupta2004simplified}

Nella trattazione successiva andremo a delineare il nostro prototipo di sistema di controllo per un
carroponte portuale, basato (come anticipato) sull'utilizzo di un PLC Zelio Logic SR3B261BD per
l'automatizzazione progressiva di un sistema precedentemente ad-hoc, basato su un Arduino MEGA. Il
basso costo del sopracitato PLC permette ad un impianto già esistente di mantenere le sue funzioni
di base, delegando ad il PLC le mansioni di telecontrollo e monitoraggio, che svolge in maniera
semplice ed affidabile.

\section{Design e componenti}

Nella presente sezione verranno descritte le scelte progettuali effettuate per la realizzazione del
prototipo.

\subsection{Struttura del carroponte}

Per la realizzazione della struttura del prototipo è stata scelta la stampa 3D, in
particolare la cosiddetta tecnica del \emph{Fused Deposition Modeling} (FDM). Essa si basa sulla
deposizione di materiale fuso su un letto di stampa, ed ha avuto per la progettazione le seguenti proprietà desiderabili.
\begin{itemize}
    \item Sicurezza dei materiali: Il progetto è stato stampato interamente in una tipologia di
        polimero detta PLA (acido polilattico), che è biodegradabile e non tossica in quanto
        prodotta dalla fermentazioni di amidi vegetali. Ciò ha permesso perciò la possibilità della
        struttura con delle stampanti casalinghe, in particolare una \emph{Eryone Thinker SE} ed una
        \emph{Wunhao GR2}.
    \item Basso costo: Una bobina di plastica per la stampa ha un costo di intorno
        \qty{15}{\euro\per\kg}, e per la realizzazione del progetto ne è stata utilizzata la maggior
        parte.
    \item Resistenza: Il PLA ha un elevata resistenza, il che previene a monte eventuali flessioni,
        rotture o deformazioni.
    \item Facilità di lavorazione: Il PLA è un materiale molto facile da lavorare, in quanto
        facilmente tagliabile, forabile e verniciabile. Si presta inoltre bene all'accoppiamento di
        molteplici parti, grazie alla sua capacità di essere giunto mediante colla o viti.
    \item Facilità di stampa: Il PLA è un materiale molto facile da stampare, in quanto non richiede
        temperature elevate o altre particolari condizioni di stampa. Ciò è in contrasto a materiali
        come l'ABS (\emph{acrilonitrile-butadiene-stirene}), che richiede un'elevata temperatura di
        stampa (intorno ai \qty{235}{\degreeCelsius} per l'estrusore contro i
        \qty{200}{\degreeCelsius} del PLA, il che può causare l'offgassing di fumi nocivi dei
        materiali che compongono la stampante in sé) e particolari condizioni di umidità, ed inoltre
        rende assolutamente necessaria una enclosure per la stampante onde evitare la dispersione
        nell'ambiente dei gas nocivi prodotti durante il processo di estrusione del materiale fuso.
        Tuttavia, come la maggior parte delle scelte progettuali in ambito ingegneristico, ciò
        consiste in un trade-off: Materiali come l'ABS hanno una elevata resistenza ai raggi
        ultravioletti del sole (che il carroponte subirebbe in caso di utilizzo in un porto reale),
        mentre il PLA diverrebbe fragile e si degraderebbe nel tempo.
\end{itemize}

Per la progettazione del modello è stato utilizzato il software \emph{AutoDesk Fusion 360}, uno dei
programmi più diffusi della AutoDesk per le progettazioni CAD. Esso permette di realizzare modelli
complessi, grazie anche alla sua vasta gamma di plugin. In particolare, grazie al plugin
\emph{Helical Gear Plus}, è stato possibile progettare su misura i vari ingranaggi e cremagliere del
carroponte.

Analizziamo nel dettaglio ora il modello, mostrato nella sua interezza assemblata in
figura~\ref{fig:allproj}.
\begin{itemize}
    \item La base inferiore del modello (cfr.\@ figura~\ref{fig:cremabase}) presenta degli slot perimetrali per l'incastro con la base
        intermedia, ed è formata nella restante parte da una cremagliera sulla quale scorre il carroponte.
    \item La base intermedia del modello (cfr.\@ figura~\ref{fig:gearbase}) presenta anch'essa degli
        slot perimetrali per l'incastro con la base inferiore e la base superiore, oltre a due
        binari nei quali scorre il carroponte e due fori per il cablaggio del servomotore presente
        sull'estremità inferiore del carroponte stesso. Durante la coordinazione delle stampe, si è
        rilevata la necessità di stampare questo pezzo in due parti, pertanto sono state aggiunti
        quattro fori per l'accoppiamento di quest'ultime mediante delle viti.
    \item La base superiore del modello (cfr.\@ figura~\ref{fig:upperbase}) presenta ovviamente
        anch'essa degli slot perimetrali per l'incastro con la base intermedia, nonché i binari per
        lo scorrimento del carroponte ed un foro posteriore per il cablaggio.
        Sulla sua superficie superiore si può trovare la nave merci, che ha due tasche per
        l'alloggio dei container e per la loro eventuale rilevazione mediante dei fotoresistori
        posti in appositi fori. Sulla parte subito successiva alla nave, ovvero sul porto, si trovano poi altre due tasche analoghe.
    \item Il carroponte (cfr.\@ figura~\ref{fig:carroponte}) ha la forma di un ferro di cavallo. Alla
        sua estremità inferiore, come anticipato, troviamo un albero di trasmissione che permette lo
        scorrimento lungo la base inferiore grazie a due ingranaggi ed un servomotore in esso
        incastonato. Alla sua estremità superiore troviamo invece due servomotori con altrettanti
        ingranaggi e cremagliere che permettono lo scorrimento del braccio magnetico (cfr.\@
        figura~\ref{fig:magnetarm}) lungo gli assi Y e Z.
\end{itemize}

\begin{figure}[!hbtp]\centering
    \caption{Il modello nella sua interezza.}\label{fig:allproj}
    \includegraphics[width=\linewidth]{renders/AllProj.png}
\end{figure}
\begin{figure}[!hbtp]\centering
    \caption{La base inferiore del modello, sostanzialmente ricoperta da una cremagliera.}\label{fig:cremabase}
    \includegraphics[width=\linewidth]{renders/CremaBase.png}
\end{figure}
\begin{figure}[!hbtp]\centering
    \caption{La base intermedia del modello.}\label{fig:gearbase}
    \includegraphics[width=\linewidth]{renders/GearBase.png}
\end{figure}
\begin{figure}[!hbtp]\centering
    \caption{La base superiore del modello, completa di nave e un container.}\label{fig:upperbase}
    \includegraphics[width=\linewidth]{renders/UpperBase-Boat-Container.PNG}
\end{figure}
\begin{figure}[!hbtp]\centering
    \caption{Il braccio che tiene l'elettromagnete.}\label{fig:magnetarm}
    \includegraphics[width=\linewidth]{renders/BraccioMagnete.png}
\end{figure}
\begin{figure}[!hbtp]\centering
    \caption{Il carroponte, completo di braccio, ingranaggi, cremagliere e servomotori.}\label{fig:lowerbase}
    \includegraphics[width=\linewidth]{renders/Carroponte.PNG}
\end{figure}

% Il modello per la stampa 3D è stato realizzato mediante il software \emph{AutoDesk Fusion 360} e
% stampato su una coppia di stampanti, rispettivamente una \emph{Eryone Thinker SE} ed una
% \emph{Wunhao GR2}. Il modello è stato realizzato in modo da poter essere stampato in più parti, date
% le limitazioni di dimensione dei piatti di stampa, e poi assemblato mediante una vasta gamma di
% accoppiamenti, tra cui incastri, colla e viti.
% 
% Sia sulla nave che sul porto sono state realizzate apposite tasche per alloggiare i container,
% all'interno delle quali sono state inserite delle fotoresistenze per la rilevazione della presenza o
% assenza di quest'ultimi.
% 
% Il porto presenta poi delle guide all'interno delle quali scorre il carroponte, mediante un
% servomotore, su un asse detta X. Sul carroponte vi sono due cremagliere, veicolate anch'esse da due
% motori servo, rispettivamente denominate Y per l'asse propria del carroponte e Z per l'asse di
% sollevamento.
% 
% L'asse Z presenta sulla sua estremità inferiore un elettromagnete controllabile mediante corrente
% continua responsabile per l'aggancio e lo sgancio dei container, i quali sono dotati di un'apposita
% parte magnetica per il sollevamento.

\section{Sistema di controllo}

Il sistema di controllo è, come anticipato, di duplice natura: Esso consiste in un PLC Zelio Logic
SR3B261BD ed un Arduino MEGA. Il primo implementa la logica di telecontrollo e
telemonitoraggio, comunicando con lo SCADA mediante il protocollo Modbus; il secondo implementa il
controllo locale dei servomotori e dei fotoresistori.

L'algoritmo di controllo automatico controlla ciclicamente la presenza di container da spostare, ed
al momento della rilevazione effettua lo spostamento senza intervento umano. Le zone sono
dinamicamente trattate come zone di carico e di scarico, cioè il carroponte è capace di rilevare
carichi posti nelle zone da operatori (che sono quindi da spostare) e carichi posti dal carroponte
stesso (che sono quindi in attesa di un operatore che li rimuova).

Particolare attenzione è stata prestata alla comunicazione tra PLC ed Arduino. I pin di
comunicazione dal PLC ad Arduino utilizzano i resistori interni pull-up di quest'ultimo, cioè ai
relè d'uscita del PLC vi è collegata la massa comune tra i due dispositivi, onde evitare problemi
per i livelli di tensione discordanti tra i due dispositivi. I pin di comunicazione da Arduino al
PLC sono perlopiù analogici, ed utilizzano un filtro passa-basso del primo ordine per rendere gli
impulsi PWM del microcontrollore un segnale analogico di tensione, estraendo da essi il livello di
continua.

Inoltre le letture dei fotoresistori utilizzano una media nel tempo (cioè formalmente un filtro
passa-basso) per evitare false rilevazioni. La loro taratura è effettuata automaticamente all'avvio
del programma, ed il microcontrollore Arduino comunica al PLC lo stato dei fotoresistori in basa
alla taratura da esso effettuata.

\section{Sistema SCADA}

Il sistema SCADA è stato realizzato con il software Vijeo Citect. Esso comunica in tempo reale con
il PLC (e quindi con Arduino) mediante il protocollo Modbus, e permette di monitorare lo stato del
sistema e di controllarlo manualmente. In particolare è possibile controllare manualmente le
posizioni di tutte e tre le assi, attivare/disattivare il magnete e ottenere le letture di tutte le
zone di carico/scarico.

\begin{figure}[htbp]\centering
    \caption{Il sistema SCADA in funzione.}
    \includegraphics[width=\linewidth]{scada.png}
\end{figure}

\begin{figure}[htbp]\centering
    \caption{Un QR code che punta ad una playlist di YouTube illustrativa del funzionamento del carroponte.}
    \qrcode{https://www.youtube.com/playlist?list=PLQibPYPJUsXOkAgrr44d6yh03rm6YIBDL}
\end{figure}

% \begin{figure}[htbp]\centering
%     \caption{Il modello 3D del carroponte.}
%     \includegraphics[width=\linewidth]{render-carroponte.png}
% \end{figure}

\begin{table}[htbp]\centering
    \caption{Gli ingressi del PLC.}
    \begin{tabularx}{\columnwidth}{@{}lcX@{}}\toprule
        \textbf{Input} & \textbf{Simbolo}                                 & \textbf{Funzione}                                 \\ \midrule
        I1             & \includegraphics[width=16px]{input-digitale}     & Lo stato dell'elettromagnete al presente momento. \\
        IB             & \includegraphics[width=16px]{input-analogico}    & La posizione corrente in Z.                       \\
        ID             & \includegraphics[width=16px]{input-analogico}    & Lettura del fotoresistore zona 1.                 \\
        IE             & \includegraphics[width=16px]{input-analogico}    & Lettura del fotoresistore zona 2.                 \\
        IF             & \includegraphics[width=16px]{input-analogico}    & Lettura del fotoresistore zona 3.                 \\
        IG             & \includegraphics[width=16px]{input-analogico}    & Lettura del fotoresistore zona 4.                 \\
        IH XT2         & \includegraphics[width=16px]{input-analogico-xt} & La posizione corrente in X.                       \\
        IJ XT2         & \includegraphics[width=16px]{input-analogico-xt} & La posizione corrente in Y.                       \\
    \bottomrule\end{tabularx}
\end{table}

\begin{table}[htbp]\centering
    \caption{Le uscite (fisiche e non) del PLC.}
    \begin{tabularx}{\columnwidth}{@{}lcX@{}}\toprule
        \textbf{Output} & \textbf{Simbolo}                              & \textbf{Funzione}                                                                                            \\ \midrule
        Q1              & \includegraphics[width=16px]{output-digitale} & Abilitazione controllo manuale.                                                                              \\
        Q2              & \includegraphics[width=16px]{output-digitale} & Stato desiderato elettromagnete.                                                                             \\
        Q3              & \includegraphics[width=16px]{output-digitale} & Posizione desiderata in Z.                                                                                   \\
        O1 XT1          & \includegraphics[width=16px]{output-scada}    & Posizione corrente in X per SCADA.                                                                           \\
        O2 XT1          & \includegraphics[width=16px]{output-scada}    & Posizione corrente in Y per SCADA.                                                                           \\
        O3 XT1          & \includegraphics[width=16px]{output-scada}    & Posizione corrente in Z per SCADA.                                                                           \\
        O4 XT1          & \includegraphics[width=16px]{output-scada}    & Insieme di bit corrispondenti alla rilevazione delle fotoresistenze e lo stato corrente dell'elettromagnete. \\
    \bottomrule\end{tabularx}
\end{table}

\begin{table}[htbp]\centering
    \caption{Blocchi configurabili del PLC.}
    \begin{tabularx}{\columnwidth}{@{}lcX@{}}\toprule
        \textbf{No.} & \textbf{Simbolo}                           & \textbf{Funzione}                                                                    \\ \midrule
        B026         & \includegraphics[width=16px]{comparator}   & Rilevazione Zona 1, OFF tra le due successive costanti numeriche e ON altrimenti.    \\
        B027         & \includegraphics[width=16px]{comparator}   & Rilevazione Zona 2, OFF tra le due successive costanti numeriche e ON altrimenti..   \\
        B028         & \includegraphics[width=16px]{comparator}   & Rilevazione Zona 3, OFF tra le due successive costanti numeriche e ON altrimenti.    \\
        B029         & \includegraphics[width=16px]{comparator}   & Rilevazione Zona 4, OFF tra le due successive costanti numeriche e ON altrimenti.DA. \\
        B030         & \includegraphics[width=16px]{num-constant} & Soglia minima zone (0).                                                              \\
        B031         & \includegraphics[width=16px]{num-constant} & Soglia massima zone (100).                                                           \\
    \bottomrule\end{tabularx}
\end{table}

\begin{table*}[htbp]\centering
    \caption{Tag di Vijeo Citect.}
    \begin{tabular}{@{}lcc@{}}\toprule
        \textbf{Nome}                               & \textbf{Indirizzo} & \textbf{Tipo di dati} \\ \midrule
        Posizione\_desiderata\_X\_J1            & \%MW16       & INT                   \\
        Posizione\_desiderata\_Y\_J2            & \%MW17       & INT                   \\
        Enable\_controllo\_manuale\_J4\_1        & \%MW19.0     & DIGITAL               \\
        Stato\_desiderato\_elettromagnete\_J4\_2 & \%MW19.1     & DIGITAL               \\
        Posizione\_desiderata\_Z\_J4\_3          & \%MW19.2     & DIGITAL               \\
        Posizione\_reale\_X\_O1                 & \%MW20       & INT                   \\
        Posizione\_reale\_Y\_O2                 & \%MW21       & INT                   \\
        Posizione\_reale\_Z\_O3                 & \%MW22       & INT                   \\
        Zona1\_O4\_1                           & \%MW23.0     & DIGITAL               \\
        Zona2\_O4\_2                           & \%MW23.1     & DIGITAL               \\
        Zona3\_O4\_3                           & \%MW23.2     & DIGITAL               \\
        Zona4\_O4\_4                           & \%MW23.3     & DIGITAL               \\
    \bottomrule\end{tabular}
\end{table*}

\printbibliography

\tcbinputlisting{title={Lo sketch principale.}, minted language=cpp, listing file=../ProgrammaPrincipale/ProgrammaPrincipale.ino}

\tcbinputlisting{title={Header per il controllo degli assi con servo.}, minted language=cpp, listing file=../ProgrammaPrincipale/ServoAxis.hpp}
\tcbinputlisting{title={File principale per il controllo degli assi con servo.}, minted language=cpp, listing file=../ProgrammaPrincipale/ServoAxis.cpp}

\tcbinputlisting{title={Header per la gestione delle zone.}, minted language=cpp, listing file=../ProgrammaPrincipale/Zone.hpp}
\tcbinputlisting{title={File principale per la gestione delle zone.}, minted language=cpp, listing file=../ProgrammaPrincipale/Zone.cpp}

\begin{figure*}[htbp]\centering
    \caption{Lo schema elettrico del sistema.}
    \includegraphics[width=\linewidth]{SchemaKiCAD}
\end{figure*}

\begin{figure*}[htbp]\centering
    \caption{Il programma caricato nel PLC.}
    \includegraphics[width=\linewidth]{programma-zelio}
\end{figure*}

\end{document}
% vim: ft=tex
